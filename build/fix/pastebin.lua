local function a()local b=arg[0]or fs.getName(shell.getRunningProgram())print("Usages:")print(b.." put <filename>")print(b.." get <code> <filename>")print(b.." run <code> <arguments>")end;local c={...}if#c<2 then a()return end;if not http then printError("Pastebin requires the http API")printError("Set http.enabled to true in CC: Tweaked's config")return end;local function d(e)local f={"^([%a%d]+)$","^https?://pastebin.com/([%a%d]+)$","^pastebin.com/([%a%d]+)$","^https?://pastebin.com/raw/([%a%d]+)$","^pastebin.com/raw/([%a%d]+)$"}for g=1,#f do local h=e:match(f[g])if h then return h end end;return nil end;local function i(j)local e=d(j)if not e then io.stderr:write("Invalid pastebin code.\n")io.write("The code is the ID at the end of the pastebin.com URL.\n")return end;write("Connecting to pastebin.com... ")local k=("%x"):format(math.random(0,2^30))local l,m=http.get("https://pastebin.com/raw/"..textutils.urlEncode(e).."?cb="..k)if l then local n=l.getResponseHeaders()if not n["Content-Type"]or not n["Content-Type"]:find("^text/plain")then io.stderr:write("Failed.\n")print("Pastebin blocked the download due to spam protection. Please complete the captcha in a web browser: https://pastebin.com/"..textutils.urlEncode(e))return end;print("Success.")local o=l.readAll()l.close()return o else io.stderr:write("Failed.\n")print(m)end end;local p=c[1]if p=="put"then local q=c[2]local r=shell.resolve(q)if not fs.exists(r)or fs.isDir(r)then print("No such file")return end;local s=fs.getName(r)local t=fs.open(r,"r")local u=t.readAll()t.close()write("Connecting to pastebin.com... ")local v="0ec2eb25b6166c0c27a394ae118ad829"local l=http.post("https://pastebin.com/api/api_post.php","api_option=paste&".."api_dev_key="..v.."&".."api_paste_format=lua&".."api_paste_name="..textutils.urlEncode(s).."&".."api_paste_code="..textutils.urlEncode(u))if l then print("Success.")local o=l.readAll()l.close()local w=string.match(o,"[^/]+$")print("Uploaded as "..o)print("Run \"pastebin get "..w.."\" to download anywhere")else print("Failed.")end elseif p=="get"then if#c<3 then a()return end;local w=c[2]local q=c[3]local r=shell.resolve(q)if fs.exists(r)then print("File already exists")return end;local x=i(w)if x then local t=fs.open(r,"w")t.write(x)t.close()print("Downloaded as "..q)end elseif p=="run"then local w=c[2]local x=i(w)if x then local y,m=load(x,w,"t",_ENV)if not y then printError(m)return end;local z,A=pcall(y,select(3,...))if not z then printError(A)end end else a()return end